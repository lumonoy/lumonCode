<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Installation_date_cancelled</name>
        <label>Installation cancelled</label>
        <locationX>2514</locationX>
        <locationY>2292</locationY>
        <actionName>Opportunity.Customer_Installation_cancelled</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Customer_Installation_cancelled</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Installation_date_changed</name>
        <label>Installation date changed</label>
        <locationX>2250</locationX>
        <locationY>2292</locationY>
        <actionName>Opportunity.Customer_Installation_date_change</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Customer_Installation_date_change</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Send installation day confirmation message to customer after it has been confirmed</description>
        <name>Installation_day_confirmation</name>
        <label>Installation day confirmation</label>
        <locationX>754</locationX>
        <locationY>2724</locationY>
        <actionName>Opportunity.Customer_Installation_date_confirmation</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Customer_Installation_date_confirmation</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>This reminder is posted to sales rep so they remember to proceed with the opportunity.</description>
        <name>Quoting_status_for_3_days</name>
        <label>Quoting status for 3 days</label>
        <locationX>4186</locationX>
        <locationY>276</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>Quoting_lasted_3_days</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>This is reminder which is send to sales user when there is 2 days form signing, but opportunity is not yet closed</description>
        <name>Signed_day_before_yesterday</name>
        <label>Signed day before yesterday reminder</label>
        <locationX>3658</locationX>
        <locationY>384</locationY>
        <actionName>Opportunity.Sales_Rep_Signed_Contract_Stage_Reminder_2</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>X2_days_from_signing_reminder</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Sales_Rep_Signed_Contract_Stage_Reminder_2</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>This reminder is send when contract has been signed yesterday</description>
        <name>Signed_yesterday_reminder</name>
        <label>Signed yesterday reminder</label>
        <locationX>3130</locationX>
        <locationY>492</locationY>
        <actionName>Opportunity.Sales_Rep_Signed_Contract_Stage_Reminder_1</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>X1_day_from_signing_message</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Sales_Rep_Signed_Contract_Stage_Reminder_1</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>notify sales rep in chatter that there is 1 day from signing</description>
        <name>X1_day_from_signing_message</name>
        <label>1 day from signing message</label>
        <locationX>3130</locationX>
        <locationY>600</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>signed_1_day_chatter</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>This posts chatter message to sales rep to remember to process opportunity</description>
        <name>X2_days_from_signing_reminder</name>
        <label>2 days from signing reminder</label>
        <locationX>3658</locationX>
        <locationY>492</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>signed_2_days_reminder</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>56.0</apiVersion>
    <assignments>
        <name>Assign_Opportunity_Name</name>
        <label>Assign Opportunity Name</label>
        <locationX>754</locationX>
        <locationY>600</locationY>
        <assignmentItems>
            <assignToReference>recOpportunity.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ChangeOpportunityName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunity.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetPhoneFromAccount</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Order_to_Opportunity</name>
        <label>Assign Order to Opportunity</label>
        <locationX>50</locationX>
        <locationY>2508</locationY>
        <assignmentItems>
            <assignToReference>recOpportunity.Order__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>recOpportunityOrder.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunity.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Schedule_Work</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Reclamation_Opportunity_Name</name>
        <label>Assign Reclamation Opportunity Name</label>
        <locationX>1018</locationX>
        <locationY>600</locationY>
        <assignmentItems>
            <assignToReference>recOpportunity.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ReclamationOpportunityName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunity.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Payment_plan_was_changed</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Stage_to_Contract_Signed</name>
        <label>Assign Stage to Contract Signed</label>
        <locationX>1458</locationX>
        <locationY>2292</locationY>
        <assignmentItems>
            <assignToReference>recOpportunity.StageName</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Contract Signed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunity.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Send_UI_Feedback</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Order_Default_Values</name>
        <label>Set Order Default Values</label>
        <locationX>50</locationX>
        <locationY>2292</locationY>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.AccountId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.Pricebook2Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Pricebook2Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.EffectiveDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Contract.StartDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.BillingAddress</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Account.BillingAddress</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>recOpportunityOrder.QuoteId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.SyncedQuoteId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Opportunity_Order</targetReference>
        </connector>
    </assignments>
    <constants>
        <description>This is case description for Building Permit Case type</description>
        <name>BuildingPermitCaseDescription</name>
        <dataType>String</dataType>
        <value>
            <stringValue>This Case was created automatically because Sales Opportunity related Preliminary Contract has been signed and work regarding Building Permit can start. Please refer to the Opportunity details when proceeding with Building Permit Application.</stringValue>
        </value>
    </constants>
    <constants>
        <description>This is used to choose Building permit type form case record type picklist</description>
        <name>BuildingPermitvalue</name>
        <dataType>String</dataType>
        <value>
            <stringValue>Building_Permit</stringValue>
        </value>
    </constants>
    <constants>
        <description>This seaches Building Permit value from case record type picklist</description>
        <name>BuildingPermitvalueID</name>
        <dataType>String</dataType>
        <value>
            <stringValue>0127E000003q2TxQAI</stringValue>
        </value>
    </constants>
    <constants>
        <description>This contains special Order handling case detail field content.</description>
        <name>SpecialOrderCaseDescription</name>
        <dataType>String</dataType>
        <value>
            <stringValue>This Case was created automatically because Sales Opportunity related Preliminary Contract has been signed and work regarding Special Order can start. Please refer to the Opportunity details when proceeding with Special Order Handling.</stringValue>
        </value>
    </constants>
    <constants>
        <description>This inputs Case Special Order record type ID</description>
        <name>SpecialOrderRecordTypeID</name>
        <dataType>String</dataType>
        <value>
            <stringValue>0127E000003q2UWQAY</stringValue>
        </value>
    </constants>
    <decisions>
        <description>In case order is returned from closed won to contract signed by admin</description>
        <name>First_time_contract_signed</name>
        <label>First time contract signed?</label>
        <locationX>182</locationX>
        <locationY>2184</locationY>
        <defaultConnector>
            <targetReference>Schedule_Work</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Contract_signed_first_time</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Order__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Order_Default_Values</targetReference>
            </connector>
            <label>Contract signed first time?</label>
        </rules>
    </decisions>
    <decisions>
        <name>From_Which_Stage</name>
        <label>From Which Stage?</label>
        <locationX>1238</locationX>
        <locationY>1692</locationY>
        <defaultConnector>
            <targetReference>To_Which_Stage</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>New Or None</defaultConnectorLabel>
        <rules>
            <name>From_Prepare</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preparation &amp; Analysis</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Prepare</label>
        </rules>
        <rules>
            <name>From_Configure</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.Quote_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Configure</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Configure</label>
        </rules>
        <rules>
            <name>From_Price</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.Quote_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Price</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Price</label>
        </rules>
        <rules>
            <name>From_Quote</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.Quote_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quote</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Quote</label>
        </rules>
        <rules>
            <name>From_Offer</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Sent</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Offer</label>
        </rules>
        <rules>
            <name>From_Preli_Contract</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preliminary Contract</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Preli Contract</label>
        </rules>
        <rules>
            <name>From_Signed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Signed</label>
        </rules>
        <rules>
            <name>From_Closed_Won</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Closed Won</label>
        </rules>
        <rules>
            <name>From_Closed_Lost</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Lost</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Closed Lost</label>
        </rules>
        <rules>
            <name>From_Cancelled</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cancelled</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>To_Which_Stage</targetReference>
            </connector>
            <label>From Cancelled</label>
        </rules>
    </decisions>
    <decisions>
        <name>Installation_date_changes_post_order</name>
        <label>Installation date changes post order</label>
        <locationX>2514</locationX>
        <locationY>2184</locationY>
        <defaultConnector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Change to Service Appointment Time</defaultConnectorLabel>
        <rules>
            <name>Installation_date_changed_post_order</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Confirmed_installation_time__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.Confirmed_installation_time__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Confirmed_installation_time__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Contact_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Installation_date_changed</targetReference>
            </connector>
            <label>Installation date changed post order</label>
        </rules>
        <rules>
            <name>Installation_cancelled</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.Confirmed_installation_time__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Confirmed_installation_time__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Contact_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Installation_date_cancelled</targetReference>
            </connector>
            <label>Installation cancelled</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_New_Opportunity</name>
        <label>Is New Opportunity?</label>
        <locationX>1238</locationX>
        <locationY>384</locationY>
        <defaultConnector>
            <targetReference>Payment_plan_was_changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Existing Opportunity</defaultConnectorLabel>
        <rules>
            <name>New_Opportunity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Normal_or_Reclamation_Opportunity</targetReference>
            </connector>
            <label>New Opportunity</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_the_previous_stage_Preliminary_Contract</name>
        <label>Is the previous stage Preliminary Contract?</label>
        <locationX>182</locationX>
        <locationY>2808</locationY>
        <defaultConnector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Preliminary_Contract_Ready_to_move_to_Final_Contract</name>
            <conditionLogic>1 AND 2 AND (3 OR 4 OR 5 OR 6)</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preliminary Contract</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Other_Reason_Resolved__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Building_Permit_Approved__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.X2nd_Measurement_Completed__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Special_Order_Case_Closed__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Status_to_Contract_Signed</targetReference>
            </connector>
            <label>Preliminary Contract Ready to move to Final Contract</label>
        </rules>
    </decisions>
    <decisions>
        <name>New_Oppo_or_Owner_changed</name>
        <label>New Oppo or Owner changed?</label>
        <locationX>1238</locationX>
        <locationY>1392</locationY>
        <defaultConnector>
            <targetReference>From_Which_Stage</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Assign_Install_Manager</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.OwnerId</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Install_mgr_to_Oppo_Team</targetReference>
            </connector>
            <label>Assign Install Manager</label>
        </rules>
    </decisions>
    <decisions>
        <name>Normal_or_Reclamation_Opportunity</name>
        <label>Normal or Reclamation Opportunity</label>
        <locationX>1018</locationX>
        <locationY>492</locationY>
        <defaultConnector>
            <targetReference>Payment_plan_was_changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Normal_Opportunity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Order_type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Normal</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Opportunity_Name</targetReference>
            </connector>
            <label>Normal Opportunity</label>
        </rules>
        <rules>
            <name>Reclamation_Opportunity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Order_type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Reclamation</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Reclamation_Opportunity_Name</targetReference>
            </connector>
            <label>Reclamation Opportunity</label>
        </rules>
    </decisions>
    <decisions>
        <description>this validates that confirmation email can be send.</description>
        <name>oppo_email_exists</name>
        <label>oppo email exists</label>
        <locationX>886</locationX>
        <locationY>2616</locationY>
        <defaultConnector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>yes_email_exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Contact_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Installation_day_confirmation</targetReference>
            </connector>
            <label>yes email exists</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opportunity_not_closed_quickly</name>
        <label>Opportunity not closed quickly</label>
        <locationX>3262</locationX>
        <locationY>384</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Opportunity_not_closed_within_1_day</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Signed_yesterday_reminder</targetReference>
            </connector>
            <label>not closed within 1 day</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opportunity_Status_Changed</name>
        <label>Opportunity Status Changed?</label>
        <locationX>1238</locationX>
        <locationY>2076</locationY>
        <defaultConnector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>New_Opportunity_Created</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preparation &amp; Analysis</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Opportunity_Record</targetReference>
            </connector>
            <label>New Opportunity Created</label>
        </rules>
        <rules>
            <name>From_Any_to_Preparation</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preparation &amp; Analysis</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Preparation &amp; Analysis</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Opportunity_Record</targetReference>
            </connector>
            <label>From Any to Preparation</label>
        </rules>
        <rules>
            <name>From_Preparation_to_Quoting</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preparation &amp; Analysis</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Opportunity_Record</targetReference>
            </connector>
            <label>From Preparation to Quoting</label>
        </rules>
        <rules>
            <name>From_Any_to_Contract_Signed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>First_time_contract_signed</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>From Any to Contract Signed</label>
        </rules>
        <rules>
            <name>From_Any_to_Closed_Lost</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Lost</stringValue>
                </rightValue>
            </conditions>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>From Any to Closed Lost</label>
        </rules>
        <rules>
            <name>From_Any_to_Closed_Won</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.StageName</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Order_ready_to_be_activated</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>From Any to Closed Won</label>
        </rules>
        <rules>
            <name>From_any_to_Preliminary_Contract_signed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preliminary Contract</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Building_Permit_Special_Order_case</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>From any to Preliminary Contract (signed)</label>
        </rules>
        <rules>
            <name>From_Any_to_Cancelled</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cancelled</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Remove_Capacity_Reservation</targetReference>
            </connector>
            <label>From Any to Cancelled</label>
        </rules>
        <rules>
            <name>Closed_Won</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.IsClosed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Installation_date_changes_post_order</targetReference>
            </connector>
            <label>Closed Won</label>
        </rules>
    </decisions>
    <decisions>
        <description>This is condition that alert is send when opportunity hasn&apos;t moved to closed stage during 2 days of signing</description>
        <name>oppportunity_not_closed</name>
        <label>oppportunity not closed</label>
        <locationX>3790</locationX>
        <locationY>276</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>not_closed_within_2_days</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Signed_day_before_yesterday</targetReference>
            </connector>
            <label>not closed within 2 days</label>
        </rules>
    </decisions>
    <decisions>
        <name>Order_ready_to_be_activated</name>
        <label>Order ready to be activated?</label>
        <locationX>1172</locationX>
        <locationY>2184</locationY>
        <defaultConnector>
            <targetReference>Assign_Stage_to_Contract_Signed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Don&apos;t Activate Order</defaultConnectorLabel>
        <rules>
            <name>Activate_Order</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Order__r.ActivatedById</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Order__r.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Order__r.Count_of_Order_Products__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Confirmed_installation_time__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Contract_Signed_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Order_type__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Reclamation</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>activate_related_final_contract</targetReference>
            </connector>
            <label>Activate Order</label>
        </rules>
        <rules>
            <name>Activate_Reclamation_Order</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Order__r.Count_of_Order_Products__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Order_type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Reclamation</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Activate_Reclamation_Related_Contract</targetReference>
            </connector>
            <label>Activate Reclamation Order</label>
        </rules>
    </decisions>
    <decisions>
        <name>Payment_plan_was_changed</name>
        <label>Payment plan was added or changed?</label>
        <locationX>1238</locationX>
        <locationY>1092</locationY>
        <defaultConnector>
            <targetReference>New_Oppo_or_Owner_changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_payment_plan_batches</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Payment_Plan__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.Payment_Plan__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Payment_plan</targetReference>
            </connector>
            <label>Create payment plan &amp; batches</label>
        </rules>
    </decisions>
    <decisions>
        <name>Skip_Automation</name>
        <label>Skip Automation?</label>
        <locationX>248</locationX>
        <locationY>276</locationY>
        <defaultConnector>
            <targetReference>Is_New_Opportunity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Continue</defaultConnectorLabel>
        <rules>
            <name>Abort</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Setup.AutomationBypass__c.SkipAutomation__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>Abort</label>
        </rules>
    </decisions>
    <decisions>
        <name>To_Which_Stage</name>
        <label>To Which Stage?</label>
        <locationX>1238</locationX>
        <locationY>1884</locationY>
        <defaultConnector>
            <targetReference>Opportunity_Status_Changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>To_Prepare</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preparation &amp; Analysis</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Prepare</label>
        </rules>
        <rules>
            <name>to_Configure</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Quote_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Configure</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Configure</label>
        </rules>
        <rules>
            <name>To_Price</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Quote_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Price</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Price</label>
        </rules>
        <rules>
            <name>To_Quote</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quoting</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Quote_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Quote</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Quote</label>
        </rules>
        <rules>
            <name>To_Offer</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Sent</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Offer</label>
        </rules>
        <rules>
            <name>To_Preli_Contract</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Preliminary Contract</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Preli Contract</label>
        </rules>
        <rules>
            <name>To_Signed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Contract Signed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Signed</label>
        </rules>
        <rules>
            <name>To_Closed_Won</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Closed Won</label>
        </rules>
        <rules>
            <name>To_Closed_Lost</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Lost</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Closed Lost</label>
        </rules>
        <rules>
            <name>To_Cancelled</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cancelled</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Status_Changed</targetReference>
            </connector>
            <label>To Cancelled</label>
        </rules>
    </decisions>
    <description>Creates payment plan, assigns installation manager to opportunity team, sends installation change notifications, release installation resources, stage change triggered updates: order creation, automated installation time confirmation, contract status updates, related contract and order activation, building permit and special order case creation, capacity removal
16.3.2023 admin notification on unsuccessful order activation added
20.3.2023 fix to activation conditions
05.04.2023 Try feedback on Order not ready to activate
13.04.2023 updated activate related order requirement contract ID
14.4.2024 order fix
24.5.2023: change the order of installation resource release and CDD check.
20.6.2023: Removed logic to release inst.resources based on checkbox value. Implemented this elsewhere.
06.07.2023 Added &apos;Get Internal IT Queue&apos; to update case owner to Internal IT Queue
06.07.2023 Add Get record for permission set.
07.07.2023 Clubbed all end points + Modified update opp records to ASSIGNMENTS and call update record at the end
07.07.2023 Included opportunity naming based on order type logic when the opportunity is created
07.07.2023 Added ID values to recOpportunity in all the assignments for Opportunity
10.07.2023 Added get recorde for technical user change Opp Won to create contract.
09.08.2023 Added implementation related to LUM-1623
09.08.2023 Added Phone from Account, for new Opp
14.08.2023  Added Order update for LUM-1623
16.08.2023 remove sign request for Closed lost
08.10.2023 Update From Stage conditions to Record_Prior
08.10.2023 Add QuoteId to Order  in Set Order Default Values
27.10.2023: Change CDD logic so that Oppo no longer contains (need to be updated) the CDD. CP and SA has it.
27.10.2023 Change the manual Contract ID
31.10.2023: Corrected the Stage transition decision to bypass the Contract Signed Stage branch for any change in Oppo. Removed the Quoting Stage from here as well (related to manual signing, which is going to be removed).
02.11.2023 Bypass booking for Reclamation
14.11.2023 Allow updated of Times after Closed Won
02.12.2023: Save Active Version as R2</description>
    <environments>Default</environments>
    <formulas>
        <description>This formula creates the case subject</description>
        <name>BuildingPermitCaseSubject</name>
        <dataType>String</dataType>
        <expression>&apos;Building Permit &apos; + {!$Record.Name}</expression>
    </formulas>
    <formulas>
        <name>ChangeOpportunityName</name>
        <dataType>String</dataType>
        <expression>left({!$Record.Account.FirstName}&amp; &quot; &quot; &amp;{!$Record.Account.LastName}, 105)&amp; &quot; - &quot; &amp; {!$Record.Opportunity_Number__c}</expression>
    </formulas>
    <formulas>
        <name>ReclamationOpportunityName</name>
        <dataType>String</dataType>
        <expression>&apos;[R]&apos; + &apos; &apos; + {!ChangeOpportunityName}</expression>
    </formulas>
    <formulas>
        <description>This searches the right case subject</description>
        <name>SpecialOrderCaseSubject</name>
        <dataType>String</dataType>
        <expression>&apos;Special Order Handling &apos; + {!$Record.Name}</expression>
    </formulas>
    <formulas>
        <description>if status is changed yesterday, reminder is send to sales rep</description>
        <name>yesterday</name>
        <dataType>DateTime</dataType>
        <expression>NOW() - 1</expression>
    </formulas>
    <interviewLabel>Opportunity - After Save {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Opportunity - After Save R2.5.4b</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Opportunity_Order</name>
        <label>Create Opportunity Order</label>
        <locationX>50</locationX>
        <locationY>2400</locationY>
        <connector>
            <targetReference>Assign_Order_to_Opportunity</targetReference>
        </connector>
        <inputReference>recOpportunityOrder</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Send_UI_Feedback</name>
        <label>Send UI Feedback</label>
        <locationX>1458</locationX>
        <locationY>2400</locationY>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <inputAssignments>
            <field>Key__c</field>
            <value>
                <stringValue>uiFeedback</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <stringValue>Please confirm Installation Date before Closing the Opportunity</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Mode__c</field>
            <value>
                <stringValue>sticky</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordId__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Title__c</field>
            <value>
                <stringValue>Order can not be Activated</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Variant__c</field>
            <value>
                <stringValue>Warning</stringValue>
            </value>
        </inputAssignments>
        <object>FeedbackEvent__e</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>GetPhoneFromAccount</name>
        <label>GetPhoneFromAccount</label>
        <locationX>754</locationX>
        <locationY>708</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>addPhoneFromAccount</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </filters>
        <filters>
            <field>PersonMobilePhone</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Activate_Reclamation_Related_Contract</name>
        <label>Activate Reclamation Related Contract</label>
        <locationX>1194</locationX>
        <locationY>2292</locationY>
        <connector>
            <targetReference>Activate_Reclamation_Related_Order</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Contract_type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Final Contract</stringValue>
            </value>
        </filters>
        <filters>
            <field>ActivatedDate</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ContractId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Activated</stringValue>
            </value>
        </inputAssignments>
        <object>Contract</object>
    </recordUpdates>
    <recordUpdates>
        <name>Activate_Reclamation_Related_Order</name>
        <label>Activate Reclamation Related Order</label>
        <locationX>1194</locationX>
        <locationY>2400</locationY>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>ActivatedDate</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>TotalAmount</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ContractId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ContractId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Activated</stringValue>
            </value>
        </inputAssignments>
        <object>Order</object>
    </recordUpdates>
    <recordUpdates>
        <name>activate_related_final_contract</name>
        <label>Activate Related Final Contract</label>
        <locationX>886</locationX>
        <locationY>2292</locationY>
        <connector>
            <targetReference>Update_Work_Order_Line_Items_on_WOs</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Contract_type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Final Contract</stringValue>
            </value>
        </filters>
        <filters>
            <field>ActivatedDate</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ContractId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Activated</stringValue>
            </value>
        </inputAssignments>
        <object>Contract</object>
    </recordUpdates>
    <recordUpdates>
        <name>Activate_related_order</name>
        <label>Activate related order</label>
        <locationX>886</locationX>
        <locationY>2508</locationY>
        <connector>
            <targetReference>oppo_email_exists</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>ActivatedDate</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>TotalAmount</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ContractId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ContractId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Activated</stringValue>
            </value>
        </inputAssignments>
        <object>Order</object>
    </recordUpdates>
    <recordUpdates>
        <name>addPhoneFromAccount</name>
        <label>addPhoneFromAccount</label>
        <locationX>754</locationX>
        <locationY>816</locationY>
        <connector>
            <targetReference>Payment_plan_was_changed</targetReference>
        </connector>
        <inputAssignments>
            <field>Phone__c</field>
            <value>
                <elementReference>GetPhoneFromAccount.PersonMobilePhone</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>stamp_1st_reminder_sent</name>
        <label>stamp 1st reminder sent</label>
        <locationX>3262</locationX>
        <locationY>276</locationY>
        <connector>
            <targetReference>Opportunity_not_closed_quickly</targetReference>
        </connector>
        <inputAssignments>
            <field>Signed_1st_reminder_sent__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Opportunity_Record</name>
        <label>Update Opportunity Record</label>
        <locationX>1238</locationX>
        <locationY>3192</locationY>
        <inputReference>recOpportunity</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Status_to_Contract_Signed</name>
        <label>Update Contract Status to Signed</label>
        <locationX>50</locationX>
        <locationY>2916</locationY>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Preliminary Contract Signed</stringValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Contract_type__c</field>
            <value>
                <stringValue>Final Contract</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Signed</stringValue>
            </value>
        </inputAssignments>
        <object>Contract</object>
    </recordUpdates>
    <start>
        <locationX>2091</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Skip_Automation</targetReference>
        </connector>
        <object>Opportunity</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <scheduledPaths>
            <name>Contract_signed_more_than_24h_ago</name>
            <connector>
                <targetReference>stamp_1st_reminder_sent</targetReference>
            </connector>
            <label>signed more than 1 day ago</label>
            <offsetNumber>1</offsetNumber>
            <offsetUnit>Days</offsetUnit>
            <recordField>Moved_to_Contract_Signed_date_time__c</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <scheduledPaths>
            <name>Contract_signed_more_than</name>
            <connector>
                <targetReference>oppportunity_not_closed</targetReference>
            </connector>
            <label>signed more than 2 days ago</label>
            <offsetNumber>2</offsetNumber>
            <offsetUnit>Days</offsetUnit>
            <recordField>Moved_to_Contract_Signed_date_time__c</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <scheduledPaths>
            <name>Quoted</name>
            <connector>
                <targetReference>Quoting_status_for_3_days</targetReference>
            </connector>
            <label>Quoted - 3 days after</label>
            <offsetNumber>3</offsetNumber>
            <offsetUnit>Days</offsetUnit>
            <recordField>Moved_to_Quoting_date_time__c</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Obsolete</status>
    <subflows>
        <name>Assign_Install_mgr_to_Oppo_Team</name>
        <label>Assign Install mgr to Oppo Team</label>
        <locationX>1106</locationX>
        <locationY>1500</locationY>
        <connector>
            <targetReference>From_Which_Stage</targetReference>
        </connector>
        <flowName>Opportunity_Assign_Install_Manager_to_Oppo_Team_Subflow</flowName>
        <inputAssignments>
            <name>Opportunity_ID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <description>This subflow creates building permit / special order cases</description>
        <name>Create_Building_Permit_Special_Order_case</name>
        <label>Create Building Permit / Special Order case</label>
        <locationX>1722</locationX>
        <locationY>2184</locationY>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <flowName>Create_Case_subflow_Building_Permit_Special_Order</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <description>Subflow creates payment plan record and payment batches records according to payment plan picklist selection</description>
        <name>Create_Payment_plan</name>
        <label>Create Payment plan</label>
        <locationX>1106</locationX>
        <locationY>1200</locationY>
        <connector>
            <targetReference>New_Oppo_or_Owner_changed</targetReference>
        </connector>
        <flowName>Opportunity_Create_Payment_Plan_Subflow</flowName>
        <inputAssignments>
            <name>rOpportunityID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <description>Finds out all related Work Orders, finds out their related Service Appointments Appointment Dependencies, removes them and then removes all Work Orders.</description>
        <name>Remove_Capacity_Reservation</name>
        <label>Remove Capacity Reservation</label>
        <locationX>1986</locationX>
        <locationY>2184</locationY>
        <connector>
            <targetReference>Update_Opportunity_Record</targetReference>
        </connector>
        <flowName>Opportunity_Remove_Capacity_Reservation_subflow</flowName>
        <inputAssignments>
            <name>OppoId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <description>Runs a subflow that gets all Service Appointments that have been soft reserved and calls an invocable method to Schedule the Service Appointment(s).</description>
        <name>Schedule_Work</name>
        <label>Schedule Work</label>
        <locationX>182</locationX>
        <locationY>2700</locationY>
        <connector>
            <targetReference>Is_the_previous_stage_Preliminary_Contract</targetReference>
        </connector>
        <flowName>Request_Work_Scheduling_Subflow</flowName>
        <inputAssignments>
            <name>OppoId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <description>Updates the work (WOLIs) to match the sold products (Oppo Products).</description>
        <name>Update_Work_Order_Line_Items_on_WOs</name>
        <label>Update Work Order Line Items on WOs</label>
        <locationX>886</locationX>
        <locationY>2400</locationY>
        <connector>
            <targetReference>Activate_related_order</targetReference>
        </connector>
        <flowName>Opportunity_Update_WO_after_Oppo_is_closed</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <textTemplates>
        <name>Contract_reminder_1</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi [{!$Record.Owner.Id}], The contract related to this opportunity has been signed 1 day ago. Please make sure you process and close opportunity within 2 days.</text>
    </textTemplates>
    <textTemplates>
        <name>Quoting_lasted_3_days</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi @[{!$Record.OwnerId}], your opportunity has been in quoting stage for 3 days. Please make sure you follow up the customer and proceed towards closing the deal.</text>
    </textTemplates>
    <textTemplates>
        <description>This is posted to rep in chatter after 1 day of being signed</description>
        <name>signed_1_day_chatter</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi @[{!$Record.OwnerId}], The contract related to this opportunity has been signed 1 day ago. Please make sure you process and close opportunity during 2 days.</text>
    </textTemplates>
    <textTemplates>
        <name>Signed_1_day_custom_notif</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi [{!$Record.OwnerId}], The contract related to this opportunity has been signed 1 day ago. Please make sure you process and close opportunity within 2 days. Thank you!</text>
    </textTemplates>
    <textTemplates>
        <name>signed_2_days_reminder</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi @[{!$Record.OwnerId}], it has been 2 days when the contract has been signed. You have only 1 day left in time to process and close opportunity.</text>
    </textTemplates>
    <textTemplates>
        <name>vAdminTaskDesc</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>This task is created because Opportunity process failed to activate Order and Opportunity was moved back to previous status &quot;Contract Signed&quot;. Please check that Opportunity has relevant base data (e.g. delivery date is filled in) which may cause failure, and proceed to assist the sales user to close their opportunity:
Opportunity: {!$Record.Id} {!$Record.Name}
Owner: {!$Record.Owner.Id}</text>
    </textTemplates>
    <textTemplates>
        <name>vAdminTaskSubject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Failed Order Activation: {!$Record.Id}</text>
    </textTemplates>
    <triggerOrder>108</triggerOrder>
    <variables>
        <name>buildingPermitRecordTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This stores quote ID when opportunity creation triggers quote creation.</description>
        <name>QuoteID_from_quote_forsync</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recOpportunity</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>recOpportunityOrder</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Order</objectType>
    </variables>
    <variables>
        <name>recOpportunityQuote</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Quote</objectType>
    </variables>
    <variables>
        <description>This stores special order case ID</description>
        <name>SpecialOrderCaseID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>specialOrderRecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>txtSelectedPricebook</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
