<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>58.0</apiVersion>
    <assignments>
        <name>Add_to_collection</name>
        <label>Add to collection</label>
        <locationX>1699</locationX>
        <locationY>1217</locationY>
        <assignmentItems>
            <assignToReference>CDLsToBeAdded</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CDLrecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Case_CDLs</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_to_collection_2</name>
        <label>Add to collection</label>
        <locationX>861</locationX>
        <locationY>1359</locationY>
        <assignmentItems>
            <assignToReference>CDLsToBeAdded</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CDLrecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>WOLI_CDLs2</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Count_of_CDL_so_far</name>
        <label>Count of CDL so far</label>
        <locationX>1839</locationX>
        <locationY>1524</locationY>
        <assignmentItems>
            <assignToReference>numCollCDLs</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>CDLsToBeAdded</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Remove_CDL</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Count_of_CDL_to_be_added</name>
        <label>Count of CDL to be added</label>
        <locationX>1390</locationX>
        <locationY>1422</locationY>
        <assignmentItems>
            <assignToReference>numCollCDLs</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>CDLsToBeAdded</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Any_CDLs_to_update_to_Case</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Create_record</name>
        <label>Create record</label>
        <locationX>1601</locationX>
        <locationY>1217</locationY>
        <assignmentItems>
            <assignToReference>CDLrecord.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CDLrecord.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_WOLI_CDLs.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CDLrecord.ShareType</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_WOLI_CDLs.ShareType</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CDLrecord.Visibility</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_WOLI_CDLs.Visibility</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Add Linked Entity Id to Case.</description>
        <name>Modify_record</name>
        <label>Modify record</label>
        <locationX>861</locationX>
        <locationY>1223</locationY>
        <assignmentItems>
            <assignToReference>CDLrecord.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CDLrecord.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>WOLI_CDLs2.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CDLrecord.ShareType</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>WOLI_CDLs2.ShareType</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CDLrecord.Visibility</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>WOLI_CDLs2.Visibility</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_collection_2</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Number_of_Case_CDLs</name>
        <label>Number of Case CDLs</label>
        <locationX>1253</locationX>
        <locationY>956</locationY>
        <assignmentItems>
            <assignToReference>nbrCaseCDLs</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Case_CDLs</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Any_CDLs_in_Case</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Number_of_WOLI_CDLs</name>
        <label>Number of WOLI CDLs</label>
        <locationX>1015</locationX>
        <locationY>717</locationY>
        <assignmentItems>
            <assignToReference>nbrWOLICDLs</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>WOLI_CDLs</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Any_CDLs_in_WOLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Remove_CDL</name>
        <label>Remove CDL</label>
        <locationX>1839</locationX>
        <locationY>1371</locationY>
        <assignmentItems>
            <assignToReference>CDLsToBeAdded</assignToReference>
            <operator>RemovePosition</operator>
            <value>
                <elementReference>numCollCDLs</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Case_CDLs</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <name>Filter_collection</name>
        <elementSubtype>SortCollectionProcessor</elementSubtype>
        <label>Filter collection</label>
        <locationX>1254</locationX>
        <locationY>1422</locationY>
        <collectionProcessorType>SortCollectionProcessor</collectionProcessorType>
        <collectionReference>CDLsToBeAdded</collectionReference>
        <connector>
            <targetReference>Count_of_CDL_to_be_added</targetReference>
        </connector>
        <sortOptions>
            <doesPutEmptyStringAndNullFirst>false</doesPutEmptyStringAndNullFirst>
            <sortField>Id</sortField>
            <sortOrder>Asc</sortOrder>
        </sortOptions>
    </collectionProcessors>
    <decisions>
        <description>If Case did not have any CDLs, then we can directly use whatever is in WOLI.
If not, then we need to remove matching (WOLI CDL = Case CDL) entries so that we don&apos;t accidentally try to add same CDL again to Case.</description>
        <name>Any_CDLs_in_Case</name>
        <label>Any CDLs in Case?</label>
        <locationX>1246</locationX>
        <locationY>1100</locationY>
        <defaultConnector>
            <targetReference>WOLI_CDLs2</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes5</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>nbrCaseCDLs</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_WOLI_CDLs</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Any_CDLs_in_WOLI</name>
        <label>Any CDLs in WOLI</label>
        <locationX>1008</locationX>
        <locationY>851</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes3</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>nbrWOLICDLs</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Case_CDLs</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Any_CDLs_to_update_to_Case</name>
        <label>Any CDLs to update to Case?</label>
        <locationX>1381</locationX>
        <locationY>1557</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes6</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>numCollCDLs</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Case_CDLs</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_there_is_related_WO</name>
        <label>Is there is related WO?</label>
        <locationX>648</locationX>
        <locationY>384</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Work_Order__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>WOLI</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_there_related_WOLI</name>
        <label>Is there related WOLI?</label>
        <locationX>776</locationX>
        <locationY>625</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Work_Order_Line_Item__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>WOLI_CDLs</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>If match is found, then that (just added) CDL needs to be removed as otherwise it would be a duplicate entry.
If no match is found, then the just added entry is kept.</description>
        <name>Matching_CDL</name>
        <label>Matching CDL</label>
        <locationX>1691</locationX>
        <locationY>1527</locationY>
        <defaultConnector>
            <targetReference>Loop_Case_CDLs</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes4</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_WOLI_CDLs.ContentDocumentId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Loop_Case_CDLs.ContentDocumentId</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Count_of_CDL_so_far</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>After the Case has been created by the Installer, the images need to be relinked from the WOLI to the Case for IM information.

6.9.2023: Fixed WOLI CDL loop references.
6.9.2023: Fixed missing Linked Entity Id issue in WOLI CDLs.
6.9.2023: Contains now also the CDL addition to Case and Case checkbox update.
02.12.2023: Save Active Version as R2</description>
    <environments>Default</environments>
    <interviewLabel>Case - Relink WOLI CDLs to Case {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case - Relink WOLI CDLs to Case R2</label>
    <loops>
        <name>Loop_Case_CDLs</name>
        <label>Case CDLs</label>
        <locationX>1699</locationX>
        <locationY>1371</locationY>
        <collectionReference>Case_CDLs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Matching_CDL</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_WOLI_CDLs</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_WOLI_CDLs</name>
        <label>WOLI CDLs</label>
        <locationX>1368</locationX>
        <locationY>1225</locationY>
        <collectionReference>WOLI_CDLs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Create_record</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Filter_collection</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>WOLI_CDLs2</name>
        <label>WOLI CDLs</label>
        <locationX>1127</locationX>
        <locationY>1231</locationY>
        <collectionReference>WOLI_CDLs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Modify_record</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Filter_collection</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Case_CDLs</name>
        <label>Create Case CDLs</label>
        <locationX>1484</locationX>
        <locationY>1673</locationY>
        <connector>
            <targetReference>Update_checkbox_on_Case</targetReference>
        </connector>
        <inputReference>CDLsToBeAdded</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Case_CDLs</name>
        <label>Case CDLs</label>
        <locationX>1132</locationX>
        <locationY>956</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Number_of_Case_CDLs</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LinkedEntityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentDocumentLink</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>ContentDocumentId</queriedFields>
        <queriedFields>ShareType</queriedFields>
        <queriedFields>Visibility</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>WOLI</name>
        <label>WOLI</label>
        <locationX>784</locationX>
        <locationY>491</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_there_related_WOLI</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Work_Order_Line_Item__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>WorkOrderLineItem</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>WOLI_CDLs</name>
        <label>WOLI CDLs</label>
        <locationX>901</locationX>
        <locationY>717</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Number_of_WOLI_CDLs</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LinkedEntityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Work_Order_Line_Item__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentDocumentLink</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>ContentDocumentId</queriedFields>
        <queriedFields>ShareType</queriedFields>
        <queriedFields>Visibility</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_checkbox_on_Case</name>
        <label>Update checkbox on Case</label>
        <locationX>1612</locationX>
        <locationY>1674</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Contains_Pictures__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordUpdates>
    <start>
        <locationX>530</locationX>
        <locationY>50</locationY>
        <filterLogic>or</filterLogic>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Quality Event: Work Continues</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Quality Event: Work Stops</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Reclamation order</stringValue>
            </value>
        </filters>
        <object>Case</object>
        <recordTriggerType>Create</recordTriggerType>
        <scheduledPaths>
            <name>X2_minutes</name>
            <connector>
                <targetReference>Is_there_is_related_WO</targetReference>
            </connector>
            <label>2 minutes</label>
            <offsetNumber>2</offsetNumber>
            <offsetUnit>Minutes</offsetUnit>
            <timeSource>RecordTriggerEvent</timeSource>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Obsolete</status>
    <variables>
        <name>CaseId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CDLrecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>CDLsToBeAdded</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>nbrCaseCDLs</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>nbrWOLICDLs</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>numCollCDLs</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
</Flow>
